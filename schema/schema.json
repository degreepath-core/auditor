{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "additionalProperties": false,
  "required": ["name", "type", "catalog", "result", "requirements"],
  "properties": {
    "name": { "type": "string" },
    "type": {
      "type": "string",
      "enum": ["degree", "major", "concentration", "emphasis"]
    },
    "catalog": { "type": "string" },
    "result": {
      "$ref": "#/definitions/rule"
    },
    "requirements": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/requirement"
      }
    }
  },
  "definitions": {
    "given-input=course-output-values": {
      "type": "string",
      "enum": [
        "courses",
        "credits",
        "grades",
        "distinct courses",
        "terms",
        "departments"
      ]
    },
    "save": {
      "type": "object",
      "required": ["given", "label", "name"],
      "oneOf": [
        {
          "properties": {
            "given": { "type": "string", "const": "courses" },
            "what": {
              "$ref": "#/definitions/given-input=course-output-values"
            },
            "where": { "type": "object" },
            "do": { "type": "string" },
            "label": { "type": "string" },
            "name": { "type": "string" }
          }
        },
        {
          "properties": {
            "given": { "type": "string", "const": "save" },
            "what": {
              "$ref": "#/definitions/given-input=course-output-values"
            },
            "where": { "type": "object" },
            "do": { "type": "string" },
            "label": { "type": "string" },
            "name": { "type": "string" }
          }
        }
      ]
    },
    "$rule": {
      "course-string": {
        "type": "string"
      },
      "course-obj": {
        "type": "object",
        "required": ["course"],
        "properties": {
          "course": { "type": "string" }
        }
      },
      "requirement-ref": {
        "type": "object",
        "additionalProperties": false,
        "required": ["requirement"],
        "properties": {
          "requirement": { "type": "string" },
          "optional": { "type": "boolean" }
        }
      }
    },
    "rule": {
      "oneOf": [
        { "$ref": "#/definitions/$rule/course-string" },
        { "$ref": "#/definitions/$rule/course-obj" },
        { "$ref": "#/definitions/$rule/requirement-ref" },
        {
          "type": "object",
          "additionalProperties": false,
          "required": ["do"],
          "properties": {
            "do": { "type": "string" }
          }
        },
        {
          "type": "object",
          "additionalProperties": false,
          "required": ["count", "of"],
          "properties": {
            "count": {
              "oneOf": [
                { "const": "all" },
                { "const": "any" },
                { "type": "number" }
              ]
            },
            "of": {
              "type": "array",
              "items": { "$ref": "#/definitions/rule" }
            }
          }
        },
        {
          "type": "object",
          "required": ["either"],
          "additionalProperties": false,
          "properties": {
            "either": {
              "type": "array",
              "items": [
                { "$ref": "#/definitions/rule" },
                { "$ref": "#/definitions/rule" }
              ]
            }
          }
        },
        {
          "type": "object",
          "required": ["both"],
          "additionalProperties": false,
          "properties": {
            "both": {
              "type": "array",
              "items": [
                { "$ref": "#/definitions/rule" },
                { "$ref": "#/definitions/rule" }
              ]
            }
          }
        },
        {
          "type": "object",
          "required": ["given", "do"],
          "properties": {
            "given": { "type": "string", "const": "courses" },
            "what": {
              "$ref": "#/definitions/given-input=course-output-values"
            },
            "where": { "type": "object" },
            "do": { "type": ["string"] }
          }
        },
        {
          "type": "object",
          "required": ["given", "do"],
          "properties": {
            "given": { "type": "string", "const": "save" },
            "save": { "type": "string" },
            "what": {
              "$ref": "#/definitions/given-input=course-output-values"
            },
            "do": { "type": ["string"] }
          }
        },
        {
          "type": "object",
          "required": ["given", "do"],
          "properties": {
            "given": { "type": "string", "const": "areas of study" },
            "what": {
              "type": "string",
              "enum": ["areas of study"]
            },
            "where": { "type": "object" },
            "do": { "type": ["string"] }
          }
        }
      ]
    },
    "requirement": {
      "oneOf": [
        {
          "additionalProperties": false,
          "required": [],
          "properties": {
            "department_audited": {
              "type": "boolean"
            },
            "contract": {
              "type": "boolean"
            },
            "message": {
              "type": "string"
            },
            "requirements": {
              "type": "object",
              "additionalProperties": {
                "$ref": "#/definitions/requirement"
              }
            },
            "save": {
              "type": "array",
              "items": { "$ref": "#/definitions/save" }
            },
            "result": {
              "$ref": "#/definitions/rule"
            }
          }
        }
      ]
    }
  }
}
